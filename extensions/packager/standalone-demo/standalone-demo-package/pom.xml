<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<parent>
		<groupId>com.elasticpath.extensions</groupId>
		<artifactId>standalone-demo-parent</artifactId>
		<version>0.0.0-SNAPSHOT</version>
	</parent>

	<artifactId>EP-Commerce-Demo</artifactId>
	<version>0.0.0-SNAPSHOT</version>
	<packaging>pom</packaging>

	<name>Standalone Demo Package</name>

	<properties>
		<commerce.extensions.version>${project.parent.version}</commerce.extensions.version>
		<!-- ActiveMQ webapp base -->
		<activemq.data>webapps/activemq-webapp-base</activemq.data>

		<!-- Search server URL -->
		<ep.search.server.url>http://localhost:38082/searchserver/</ep.search.server.url>

		<!-- Database configuration settings -->
		<epdb.maven.groupId>com.h2database</epdb.maven.groupId>
		<epdb.maven.artifactId>h2</epdb.maven.artifactId>
		<epdb.maven.version>${com.h2database.version}</epdb.maven.version>
		<epdb.maven.username>sa</epdb.maven.username>
		<epdb.maven.password>sa</epdb.maven.password>
	</properties>

	<dependencies>
		<!-- DB driver -->
		<dependency>
			<groupId>${epdb.maven.groupId}</groupId>
			<artifactId>${epdb.maven.artifactId}</artifactId>
			<version>${epdb.maven.version}</version>
		</dependency>

		<!-- ActiveMQ dependencies for EP webapps -->
		<dependency>
			<groupId>org.apache.activemq</groupId>
			<artifactId>activemq-pool</artifactId>
			<version>${org.apache.activemq.version}</version>
		</dependency>
		<dependency>
			<groupId>org.apache.activemq</groupId>
			<artifactId>activemq-jms-pool</artifactId>
			<version>${org.apache.activemq.version}</version>
		</dependency>
		<dependency>
			<groupId>org.apache.activemq</groupId>
			<artifactId>activemq-client</artifactId>
			<version>${org.apache.activemq.version}</version>
		</dependency>
		<dependency>
			<groupId>org.apache.commons</groupId>
			<artifactId>commons-pool2</artifactId>
			<version>${org.apache.commons.pool2.version}</version>
		</dependency>
		<dependency>
			<groupId>org.apache.geronimo.specs</groupId>
			<artifactId>geronimo-j2ee-management_1.1_spec</artifactId>
			<version>${org.apache.geronimo.management.spec.version}</version>
		</dependency>
		<dependency>
			<groupId>org.apache.geronimo.specs</groupId>
			<artifactId>geronimo-jms_1.1_spec</artifactId>
			<version>${org.apache.geronimo.specs.version}</version>
			<scope>compile</scope>
		</dependency>
		<dependency>
			<groupId>org.slf4j</groupId>
			<artifactId>slf4j-api</artifactId>
			<version>1.6.6</version>
		</dependency>
		<dependency>
			<groupId>org.fusesource.hawtbuf</groupId>
			<artifactId>hawtbuf</artifactId>
			<version>1.9</version>
		</dependency>
		<dependency>
			<groupId>javax.servlet</groupId>
			<artifactId>jstl</artifactId>
			<version>1.1.2</version>
		</dependency>
		<dependency>
			<groupId>taglibs</groupId>
			<artifactId>standard</artifactId>
			<version>1.1.2</version>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-dependency-plugin</artifactId>
				<version>2.8</version>
				<executions>
					<execution>
						<id>download-tomcat</id>
						<phase>generate-sources</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>org.apache.tomcat</groupId>
									<artifactId>tomcat</artifactId>
									<version>${tomcat.version}</version>
									<type>zip</type>
									<outputDirectory>${project.build.directory}/downloads/</outputDirectory>
									<excludes>*/webapps/**</excludes>
								</artifactItem>
							</artifactItems>
							<overWriteReleases>true</overWriteReleases>
							<overWriteSnapshots>true</overWriteSnapshots>
						</configuration>
					</execution>
					<execution>
						<id>unpack-activemq-webapp</id>
						<phase>generate-sources</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>org.apache.activemq</groupId>
									<artifactId>activemq-web-console</artifactId>
									<version>${org.apache.activemq.version}</version>
									<overWrite>true</overWrite>
									<type>war</type>
									<outputDirectory>${project.build.directory}/catalina-bases/activemq-webapp-base/webapps/jms</outputDirectory>
								</artifactItem>
							</artifactItems>
							<overWriteReleases>true</overWriteReleases>
							<overWriteSnapshots>true</overWriteSnapshots>
						</configuration>
					</execution>
					<execution>
						<id>unpack-cortex-webapp</id>
						<phase>generate-sources</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>com.elasticpath.extensions</groupId>
									<artifactId>ext-cortex-webapp</artifactId>
									<version>${commerce.extensions.version}</version>
									<overWrite>true</overWrite>
									<type>war</type>
									<outputDirectory>${project.build.directory}/catalina-bases/ep-cortex-webapp-base/webapps/cortex</outputDirectory>
								</artifactItem>
							</artifactItems>
							<overWriteReleases>true</overWriteReleases>
							<overWriteSnapshots>true</overWriteSnapshots>
						</configuration>
					</execution>
					<execution>
						<id>unpack-studio-webapp</id>
						<phase>generate-sources</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>com.elasticpath.rest.relos</groupId>
									<artifactId>ep-rest-studio</artifactId>
									<version>${api-platform.version}</version>
									<overWrite>true</overWrite>
									<type>war</type>
									<!-- Studio intentionally lives in the cortex container. -->
									<outputDirectory>${project.build.directory}/catalina-bases/ep-cortex-webapp-base/webapps/studio</outputDirectory>
								</artifactItem>
							</artifactItems>
							<overWriteReleases>true</overWriteReleases>
							<overWriteSnapshots>true</overWriteSnapshots>
						</configuration>
					</execution>
					<execution>
						<id>unpack-search-webapp</id>
						<phase>generate-sources</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>com.elasticpath.extensions</groupId>
									<artifactId>ext-search-webapp</artifactId>
									<version>${commerce.extensions.version}</version>
									<overWrite>true</overWrite>
									<type>war</type>
									<outputDirectory>${project.build.directory}/catalina-bases/ep-search-webapp-base/webapps/searchserver
									</outputDirectory>
								</artifactItem>
							</artifactItems>
							<overWriteReleases>true</overWriteReleases>
							<overWriteSnapshots>true</overWriteSnapshots>
						</configuration>
					</execution>
					<execution>
						<id>unpack-integration-webapp</id>
						<phase>generate-sources</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>com.elasticpath.extensions</groupId>
									<artifactId>ext-integration-webapp</artifactId>
									<version>${commerce.extensions.version}</version>
									<overWrite>true</overWrite>
									<type>war</type>
									<outputDirectory>${project.build.directory}/catalina-bases/ep-integration-webapp-base/webapps/integration
									</outputDirectory>
								</artifactItem>
							</artifactItems>
							<overWriteReleases>true</overWriteReleases>
							<overWriteSnapshots>true</overWriteSnapshots>
						</configuration>
					</execution>
					<execution>
						<id>unpack-cmwebapp</id>
						<phase>generate-sources</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>com.elasticpath.extensions.cm</groupId>
									<artifactId>ext-cm-webapp</artifactId>
									<version>${commerce.extensions.version}</version>
									<overWrite>true</overWrite>
									<type>war</type>
									<outputDirectory>${project.build.directory}/catalina-bases/ep-cm-webapp-base/webapps/admin
									</outputDirectory>
								</artifactItem>
							</artifactItems>
							<overWriteReleases>true</overWriteReleases>
							<overWriteSnapshots>true</overWriteSnapshots>
						</configuration>
					</execution>

					<execution>
						<id>unpack-ext-assets</id>
						<phase>generate-sources</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>com.elasticpath.extensions</groupId>
									<artifactId>ext-assets</artifactId>
									<version>${commerce.extensions.version}</version>
									<classifier>assets</classifier>
									<type>zip</type>
									<overWrite>true</overWrite>
								</artifactItem>
							</artifactItems>
							<outputDirectory>${project.build.directory}/assets</outputDirectory>
						</configuration>
					</execution>
					<execution>
						<id>unpack-demo-database</id>
						<phase>generate-sources</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>com.elasticpath.extensions</groupId>
									<artifactId>standalone-demo-h2-database</artifactId>
									<version>${commerce.extensions.version}</version>
									<type>zip</type>
									<overWrite>true</overWrite>
								</artifactItem>
							</artifactItems>
							<outputDirectory>${project.build.directory}/database</outputDirectory>
						</configuration>
					</execution>
					<execution>
						<id>unpack-import-export</id>
						<phase>generate-sources</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>com.elasticpath.extensions</groupId>
									<artifactId>ext-importexport-cli</artifactId>
									<version>${commerce.extensions.version}</version>
									<classifier>bin</classifier>
									<type>zip</type>
									<overWrite>true</overWrite>
								</artifactItem>
							</artifactItems>
							<outputDirectory>${project.build.directory}/importexport</outputDirectory>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<!-- Filter a copy of the activemq.xml configuration file to configure the kahadb message store directory for the package. -->
				<artifactId>maven-resources-plugin</artifactId>
				<executions>
					<execution>
						<id>copy-resources</id>
						<phase>process-sources</phase>
						<goals>
							<goal>copy-resources</goal>
						</goals>
						<configuration>
							<outputDirectory>${project.build.directory}/catalina-bases/activemq-webapp-base/webapps/jms/WEB-INF</outputDirectory>
							<resources>
								<resource>
									<directory>src/main/activemq</directory>
									<filtering>true</filtering>
								</resource>
							</resources>
						</configuration>
					</execution>
					<execution>
						<id>configure-data-environment</id>
						<phase>process-sources</phase>
						<goals>
							<goal>resources</goal>
						</goals>
						<configuration>
							<escapeWindowsPaths>false</escapeWindowsPaths>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>com.google.code.maven-replacer-plugin</groupId>
				<artifactId>maven-replacer-plugin</artifactId>
				<executions>
					<!-- This is for setting the target log directories into one central place, so that this package is self-encapsulating. -->
					<execution>
						<id>replace-target-log-directories</id>
						<phase>generate-resources</phase>
						<goals>
							<goal>replace</goal>
						</goals>
						<configuration>
							<includes>
								<include>
									**/misc/log4j.properties
								</include>
								<include>
									**/classes/log4j.properties
								</include>
								<include>
									**/classes/logback.xml
								</include>
							</includes>
							<token>
								\$\{user\.home\}\/ep
							</token>
							<value>
								target
							</value>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<artifactId>maven-assembly-plugin</artifactId>
				<version>${maven-assembly-plugin.version}</version>
				<configuration>
					<archiverConfig>
						<defaultDirectoryMode>493</defaultDirectoryMode>
					</archiverConfig>
				</configuration>
				<executions>
					<execution>
						<id>prepare-demo-package</id>
						<phase>prepare-package</phase>
						<goals>
							<goal>single</goal>
						</goals>
						<configuration>
							<finalName>assembly</finalName>
							<appendAssemblyId>false</appendAssemblyId>
							<descriptors>
								<descriptor>src/main/assembly/assemble.xml</descriptor>
							</descriptors>
						</configuration>
					</execution>
					<execution>
						<id>create-demo-package-zip</id>
						<phase>package</phase>
						<goals>
							<goal>single</goal>
						</goals>
						<configuration>
							<appendAssemblyId>false</appendAssemblyId>
							<descriptors>
								<descriptor>src/main/assembly/package.xml</descriptor>
							</descriptors>
						</configuration>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>
</project>